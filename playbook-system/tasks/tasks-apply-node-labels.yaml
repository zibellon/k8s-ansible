# =============================================================================
# Apply node labels
# =============================================================================
# Requires:
#   - new_hostname
#   - node_labels (optional, list of labels)
# Optional:
#   - kubectl_delegate_host (if kubectl runs on another host)
# =============================================================================

- name: Apply node labels
  command: "kubectl label nodes {{ new_hostname }} {{ item }} --overwrite"
  delegate_to: "{{ kubectl_delegate_host | default(omit) }}"
  loop: "{{ node_labels | default([]) }}"
  when: node_labels is defined and node_labels | length > 0
  register: label_result
  failed_when: false

- name: Print applied labels
  debug:
    msg: "Applied labels to {{ new_hostname }}: {{ node_labels }}"
  when: node_labels is defined and node_labels | length > 0

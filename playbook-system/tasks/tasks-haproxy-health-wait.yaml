# =============================================================================
# Wait for HAProxy to be healthy
# =============================================================================
# Used with serial: 1 play for sequential execution across hosts
# =============================================================================

---
- name: Wait for HAProxy to be healthy
  uri:
    url: "http://127.0.0.1:{{ haproxy_apiserver_lb_healthz_port }}/healthz"
    status_code: 200
  register: _haproxy_health
  until: _haproxy_health.status == 200
  retries: 30
  delay: 2

- name: HAProxy is ready
  debug:
    msg: "HAProxy ready at 127.0.0.1:{{ haproxy_apiserver_lb_port }}"

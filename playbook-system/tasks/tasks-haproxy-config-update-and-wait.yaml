# =============================================================================
# Update HAProxy config on a single host and wait for reload
# =============================================================================
# Required variables:
#   - target_host: hostname to update HAProxy config on
#
# This file is designed to be called in a loop for sequential execution:
#   - name: Update HAProxy sequentially
#     include_tasks: tasks/tasks-haproxy-config-update-and-wait.yaml
#     loop: "{{ groups['all'] }}"
#     loop_control:
#       loop_var: target_host
#     run_once: true
# =============================================================================

---
- name: "[{{ target_host }}] Generate HAProxy config"
  include_tasks: tasks/tasks-generate-haproxy-config.yaml

- name: "[{{ target_host }}] Wait for HAProxy"
  include_tasks: tasks/tasks-haproxy-health-wait.yaml

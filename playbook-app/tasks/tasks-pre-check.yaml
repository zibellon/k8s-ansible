# =============================================================================
# Pre-check: auto-detect master manager, fail if not found
# =============================================================================
# Shared tasks for validating playbook target
#
# Used by all *-install.yaml and *-sync.yaml playbooks
#
# Params:
#   - label_name: Label prefix for task names (e.g. "cilium-install-pre-check")
#
# Sets fact: master_manager_fact
# Fails if no host with is_master: true exists in managers group
# =============================================================================

- name: "[{{ label_name }}] Set master manager fact"
  include_tasks: tasks/tasks-set-master-manager.yaml

- name: "[{{ label_name }}] Fail if master manager not found"
  fail:
    msg: "ERROR: No host with is_master: true found in managers group"
  when: not is_master_manager_exist
  run_once: true

- name: "[{{ label_name }}] Confirm master manager"
  debug:
    msg: "Using master manager: {{ master_manager_fact }}"
  delegate_to: "{{ master_manager_fact }}"
  run_once: true

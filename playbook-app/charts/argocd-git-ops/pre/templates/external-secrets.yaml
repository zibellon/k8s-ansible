{{- range $secret := .Values.eso.secrets }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ $secret.external_secret_name }}
  namespace: {{ $.Values.namespace }}
spec:
  refreshInterval: {{ $secret.refresh_interval }}
  secretStoreRef:
    kind: SecretStore
    name: {{ $.Values.eso.secretStoreName }}
  target:
    name: {{ $secret.target_secret_name }}
    template:
      engineVersion: v2
      metadata:
        labels:
          argocd.argoproj.io/secret-type: repo-creds
      data:
        type: git
        url: "{{ $.Values.gitlab.internalUrl }}"
        sshPrivateKey: "{{ "{{" }} .ssh_private_key {{ "}}" }}"
  data:
    - secretKey: ssh_private_key
      remoteRef:
        key: "{{ $.Values.eso.kvEnginePath }}/data{{ $secret.vault_path }}"
        property: ssh_private_key
{{- end }}
